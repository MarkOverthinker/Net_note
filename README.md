# 三次握手

三次握手的原理总结为三条：

1. 双方都要向对方发送SYN
2. 双方都要收到对方对于自己SYN的ACK
3. 双方都要收到对方的SYN并对对方的SYN发出ACK回应

满足这三条之后进入连接已建立状态。

只满足1,3其实就是SYN\_RCVD状态，此时再收到对方对于SYN的ACK即可进入连接状态

只满足1就是状态SYN\_SENT，此时再等到对面的SYN+ACK就是满足了1，2和3的前半部分，那么再回复一个ACK就满足了全部条件，即可进入连接状态

几种特殊情况下的状态转移也是

例：双方都同时（同时指都在处于初始状态的时候发送）发送SYN的情况：

发送后满足条件1，两者都进入SYN\_SENT状态。之后双方都收到对方的SYN，此时双方肯定至少都要回复ACK以满足条件3。此时双方进入SYN\_SENT状态。

在确定双方的报文都一定能到达的情况下，此时单回复一个ACK已经足以建立连接，等对方都收到ACK的时候双方就可以建立连接了。

但是双方的报文时不一定能到达的。如果只有一方收到了SYN，那么只回复ACK肯定是建立不了连接的。（实际上双方都不知道自己未收到对方的ACK而只收到SYN是因为自己发送的SYN丢失了还是因为双方同时发了SYN）且双方不知道对方是否收到了己方的SYN（没收到对方的ACK），所以应回复SYN+ACK，在回复SYN\_ACK的情况下，无论是上述哪种情况都能建立连接。
